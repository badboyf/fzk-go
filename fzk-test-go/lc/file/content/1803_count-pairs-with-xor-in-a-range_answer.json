{
  "data": {
    "solutionArticle": {
      "__typename": "SolutionArticleNode",
      "author": {
        "__typename": "UserNode",
        "profile": {
          "__typename": "UserProfileNode",
          "realName": "hqztrueğŸ¸",
          "userAvatar": "https://assets.leetcode-cn.com/aliyun-lc-upload/users/hqztrue/avatar_1605404429.png",
          "userSlug": "hqztrue"
        },
        "username": "hqztrue"
      },
      "byLeetcode": false,
      "canEdit": false,
      "canEditReward": false,
      "canSee": true,
      "chargeType": "FREE",
      "content": "### è§£é¢˜æ€è·¯\nä»€ä¹ˆï¼Œ[JSæš´åŠ›è¿‡äº†](https://leetcode-cn.com/problems/count-pairs-with-xor-in-a-range/solution/tong-ji-yi-huo-zhi-zai-fan-wei-nei-de-sh-038k/)ï¼Ÿä»€ä¹ˆï¼Œ[Javaæš´åŠ›ä¹Ÿè¿‡äº†](https://leetcode-cn.com/problems/count-pairs-with-xor-in-a-range/solution/javabao-li-jiao-xing-tong-guo-1650-ms-by-1jzs/)ï¼Ÿä»€ä¹ˆï¼Œ[è¿Pythonæš´åŠ›éƒ½è¿‡äº†](https://leetcode.com/problems/count-pairs-with-xor-in-a-range/discuss/1119721/Python-NumPy-bruteforce-O(N2))ï¼Ÿç„¶è€Œæˆ‘ä»¬ä¼Ÿå¤§çš„C++åœ¨å“ªé‡Œï¼Ÿæˆ‘è¦æŠ•è¯‰ï¼Œè¿™æ˜¯è¯­è¨€æ­§è§†ï¼\n\né¦–å…ˆäº¤ä¸€ä¸ªæœ€æœ´ç´ çš„$O(n^2)$æš´åŠ›çœ‹çœ‹ï¼š\n```cpp\nclass Solution {\npublic:\n\tint countPairs(vector<int>& a, int l, int r) {\n\t\tint n=a.size(),ans=0;\n\t\tfor (int i=0;i<n;++i)\n\t\t\tfor (int j=i+1;j<n;++j){\n\t\t\t\tint x=a[i]^a[j];\n\t\t\t\tans+=x>=l&&x<=r;\n\t\t\t}\n\t\treturn ans;\n\t}\n};\n```\næœä¸å…¶ç„¶ï¼Œåœ¨ç¬¬48/61ä¸ªç‚¹å°±è¶…æ—¶äº†ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„è¿è¡Œé€Ÿåº¦ï¼šè€ƒè™‘å¦‚ä¸‹æé™æ•°æ®ï¼Œnums=1,...,20000ï¼Œlow=1, high=20000ï¼Œè¿™æ®µç¨‹åºéœ€è¦è·‘1452msã€‚ä»¥ä¸‹æ—¶é—´æµ‹è¯•å‡ä»¥æ­¤æ•°æ®ä½œä¸ºåŸºå‡†(å› ä¸ºç›´æ¥æäº¤ä¼šæ˜¾ç¤ºè¶…æ—¶ï¼Œä¸çŸ¥é“è·‘äº†å¤šä¹…)ã€‚\n\næˆ‘ä»¬çŸ¥é“LeetCodeä¸Šçš„C++æ˜¯ä¼šå¼€å¯-O2ä¼˜åŒ–çš„ã€‚ä½†æ˜¯æˆ‘ä»¬è¦æœ‰æ¯”ç¼–è¯‘å™¨æ›´èªæ˜çš„è‡ªä¿¡ã€‚å°†vectoræ”¹ä¸ºæ™®é€šæ•°ç»„ï¼Œå¯ä»¥é€šè¿‡56/61ä¸ªç‚¹ï¼Œä¸”æµ‹è¯•æ•°æ®ä¸Šçš„è¿è¡Œæ—¶é—´ä¹Ÿç‹‚é™åˆ°äº†412msï¼š\n```cpp\nclass Solution {\npublic:\n\tint countPairs(vector<int>& _a, int l, int r) {\n\t\tint n=_a.size(),*a=&_a[0],ans=0;\n\t\tfor (int i=0;i<n;++i)\n\t\t\tfor (int j=i+1;j<n;++j){\n\t\t\t\tint x=a[i]^a[j];\n\t\t\t\tans+=x>=l&&x<=r;\n\t\t\t}\n\t\treturn ans;\n\t}\n};\n```\nè¿™å°±ç¦»è°±äº†ï¼Œçœ‹æ¥clang 11çš„-O2ä¼˜åŒ–è¿˜æ˜¯ä¸å¤ªè¡Œã€‚  \nè™½ç„¶ç°åœ¨åœ¨å•ä¸ªæé™æ•°æ®ä¸Šçš„è¿è¡Œé€Ÿåº¦ä¹Ÿä¸ç®—æ…¢ï¼Œä¸è¿‡LCåˆ¤æ–­TLEç”¨çš„æ˜¯æ‰€æœ‰æ•°æ®ä¸Šçš„æ€»è¿è¡Œæ—¶é—´ã€‚æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­ä¼˜åŒ–ã€‚\n\næ¥ä¸‹æ¥è€ƒè™‘æ‰‹åŠ¨å¹¶è¡Œå±•å¼€åˆºæ¿€CPUå¹¶å‘ã€‚ç†è®ºä¸Šåœ¨é«˜ä¼˜åŒ–çº§åˆ«ä¸‹è¿™äº›éƒ½æ˜¯é›•è™«å°æŠ€ï¼Œä¸è¿‡è¿™é‡Œåˆå¥æ•ˆäº†ï¼Œåœ¨æˆ‘ä»¬çš„æµ‹è¯•æ•°æ®ä¸Šçš„è¿è¡Œæ—¶é—´ç»§ç»­é™åˆ°äº†252msã€‚æäº¤ä¸€ä¸‹å‘ç°é€šè¿‡äº†æ‰€æœ‰61ä¸ªæµ‹è¯•æ•°æ®ï¼Œå¯æ˜¯...\n![3.png](https://pic.leetcode-cn.com/1616355024-gjVEQY-3.png)\nå¿ƒæ€æœ‰ç‚¹çˆ†ç‚¸ã€‚\n```cpp\n#define us unsigned short\nus a[20015];\nclass Solution {\npublic:\n\tint countPairs(vector<int>& _a, us l, us r) {\n\t\tint n=_a.size(),ans=0;\n\t\tfor (int i=0;i<n;++i)a[i]=_a[i];\n\t\tfor (us *i=a,*end=i+n;i!=end;++i){\n\t\t\tus *j=i+1,*end1=end-8;\n\t\t\tfor (;j<end1;j+=8){\n\t\t\t\tus x=*i^*j,x1=*i^*(j+1),x2=*i^*(j+2),x3=*i^*(j+3),\n\t\t\t\t\tx4=*i^*(j+4),x5=*i^*(j+5),x6=*i^*(j+6),x7=*i^*(j+7);\n\t\t\t\tans+=(x>=l&&x<=r)+(x1>=l&&x1<=r)+(x2>=l&&x2<=r)+(x3>=l&&x3<=r)\n\t\t\t\t\t+(x4>=l&&x4<=r)+(x5>=l&&x5<=r)+(x6>=l&&x6<=r)+(x7>=l&&x7<=r);\n\t\t\t}\n\t\t\tfor (;j<end;++j)ans+=(*i^*j)>=l&&(*i^*j)<=r;\n\t\t}\n\t\treturn ans;\n\t}\n};\n```\n  \né‚£ä¹ˆæœ€åå†åŠ ä¸€ä¸ªé’ˆå¯¹æ•°æ®çš„å°ä¼˜åŒ–ï¼Œåˆå¹¶ä¸€ä¸‹ç›¸åŒçš„æ•°å­—ã€‚(è¿™æ˜¯[Javaæš´åŠ›ACé‚£ç¯‡æ–‡ç« ](https://leetcode-cn.com/problems/count-pairs-with-xor-in-a-range/solution/javabao-li-jiao-xing-tong-guo-1650-ms-by-1jzs/)ä¸­ä½¿ç”¨çš„æŠ€å·§ï¼Œä¸è¿‡ç›´æ¥æŠŠé‚£ä»½Javaä»£ç ç¿»è¯‘æˆC++çš„è¯ä¹Ÿä¼šTLEã€‚)è¿™ä¸ªä¼˜åŒ–å¯¹æˆ‘ä»¬çš„æé™æµ‹è¯•æ•°æ®æ˜¯æ— æ•ˆçš„ï¼Œä¸è¿‡æäº¤ä¸€ä¸‹å‘ç°ACäº†ï¼š\n![4.png](https://pic.leetcode-cn.com/1616355765-KdMuqa-4.png)\n\n\n```cpp\n#define us unsigned short\nus a[20015];\nclass Solution {\npublic:\n\tint countPairs(vector<int>& _a, us l, us r) {\n\t\tint n=_a.size(),ans=0; int d=0;\n\t\tfor (int i=0;i<n;++i)a[i]=_a[i];\n\t\tsort(a,a+n);\n\t\tfor (us *i=a,*end=i+n;i!=end;++i){\n\t\t\tif (i>a&&*i==*(i-1)){ans+=d; continue;}\n\t\t\tus *j=i+1,*end1=end-8; d=0;\n\t\t\tfor (;j<end1;j+=8){\n\t\t\t\tus x=*i^*j,x1=*i^*(j+1),x2=*i^*(j+2),x3=*i^*(j+3),\n\t\t\t\t\tx4=*i^*(j+4),x5=*i^*(j+5),x6=*i^*(j+6),x7=*i^*(j+7);\n\t\t\t\td+=(x>=l&&x<=r)+(x1>=l&&x1<=r)+(x2>=l&&x2<=r)+(x3>=l&&x3<=r)\n\t\t\t\t\t+(x4>=l&&x4<=r)+(x5>=l&&x5<=r)+(x6>=l&&x6<=r)+(x7>=l&&x7<=r);\n\t\t\t}\n\t\t\tfor (;j<end;++j)d+=(*i^*j)>=l&&(*i^*j)<=r;\n\t\t\tans+=d;\n\t\t}\n\t\treturn ans;\n\t}\n};\n```\næ³¨æ„è™½ç„¶è¿™ä¸ªä¼˜åŒ–é’ˆå¯¹äº†æ•°æ®ç‰¹æ€§ï¼Œä½†æäº¤å•ç»„æé™æµ‹è¯•æ•°æ®æ˜¯å‰ä¸æ‰çš„ï¼Œéœ€è¦å¢åŠ å¤šç»„æœ€åæ•°æ®ä½¿å¾—æ€»è¿è¡Œæ—¶é—´æ˜¾è‘—å¢åŠ æ‰èƒ½å‰æ‰ã€‚  \n  \né‚£ä¹ˆæš´åŠ›è¿˜å¯ä»¥æ›´å¿«ä¹ˆï¼Ÿä¸‹é¢æˆ‘ä»¬ä½¿ç”¨avx2æŒ‡ä»¤é›†ã€‚åœ¨æˆ‘ä»¬çš„æµ‹è¯•æ•°æ®ä¸Šåªéœ€è¦24msï¼Œæäº¤ä¸€ä¸‹çœ‹çœ‹ï¼š\n![4.png](https://pic.leetcode-cn.com/1616373233-MlrptK-4.png)\nè¿™ä¸ªé€Ÿåº¦å·²ç»å’Œå­—å…¸æ ‘ä¸ç›¸ä¸Šä¸‹äº†ã€‚  \n```cpp\n#include<immintrin.h>\n#define us unsigned short\nconst int N=20005;\nus a[N] __attribute__((aligned(32)));\n#define _mm256_cmple_epi16(a,b) ((__m256i)((__v16hi)a<=(__v16hi)b))\n#define _mm256_cmpge_epi16(a,b) ((__m256i)((__v16hi)a>=(__v16hi)b))\nclass Solution {\npublic:\n\t__attribute__((no_sanitize_address,no_sanitize_memory))\n\t__attribute__((target(\"avx2\")))\n\tint countPairs(vector<int>& _a, us l, us r) {\n\t\tint n=_a.size(),ans=0,d=0;\n\t\tfor (int i=0;i<n;++i)a[i]=_a[i];\n\t\tsort(a,a+n);\n\t\t__m256i L=_mm256_set1_epi16(l),\n\t\t\t\tR=_mm256_set1_epi16(r),\n\t\t\t\tmask=_mm256_set1_epi16(1);\n\t\tfor (int i=0;i<n;++i){\n\t\t\tif (i&&a[i]==a[i-1]){ans+=d; continue;}\n\t\t\tus x=a[i]; int j=i+1; d=0;\n\t\t\t__m256i X=_mm256_set1_epi16(x),res=_mm256_setzero_si256();\n\t\t\tfor (;(j&15)&&j<n;++j)d+=(x^a[j])>=l&&(x^a[j])<=r;\n\t\t\tif (j<n)for (__m256i *I=(__m256i*)(a+j),*end=(__m256i*)(a+(n&~15));I!=end;++I){\n\t\t\t\t__m256i Y=_mm256_xor_si256(X,*I);\n\t\t\t\tres=_mm256_add_epi16(res,_mm256_and_si256(_mm256_and_si256(_mm256_cmpge_epi16(Y,L),_mm256_cmple_epi16(Y,R)),mask));\n\t\t\t}\n\t\t\tfor (int k=0;k<16;++k)d+=((us*)&res)[k];\n\t\t\tfor (j=max(j,n&~15);j<n;++j)d+=(x^a[j])>=l&&(x^a[j])<=r;\n\t\t\tans+=d;\n\t\t}\n\t\treturn ans;\n\t}\n};\n```\næˆ‘ä»¬è¿˜å¯ä»¥æ¢æˆavx512ï¼š(æ³¨æ„åœ¨LC-USç«™ä¼šå´©æºƒï¼Œåº”è¯¥æ˜¯ä¸¤è¾¹æœåŠ¡å™¨cpuå‹å·ä¸åŒ)\n![1803_96ms_cn_.png](https://pic.leetcode-cn.com/1616450863-WRnfLB-1803_96ms_cn_.png)\n\nåˆå¿«äº†40%ï¼Œå°±ç®—å’Œå­—å…¸æ ‘ä¸€èµ·æ¯”è¾ƒä¹Ÿå¯ä»¥æ’åœ¨ç¬¬äºŒã€‚\n```cpp\n#include<immintrin.h>\n#define us unsigned short\nconst int N=20005,U=31;\nus a[N] __attribute__((aligned(64)));\nclass Solution {\npublic:\n\t__attribute__((no_sanitize_address,no_sanitize_memory))\n\t__attribute__((target(\"avx512bw\")))\n\tint countPairs(vector<int>& _a, us l, us r) {\n\t\tint n=_a.size(),ans=0,d=0;\n\t\tfor (int i=0;i<n;++i)a[i]=_a[i];\n\t\tsort(a,a+n);\n\t\t__m512i L=_mm512_set1_epi16(l),R=_mm512_set1_epi16(r);\n\t\tfor (int i=1;i<n;++i){\n\t\t\tif (a[i]!=a[i-1]){\n\t\t\t\tus x=a[i]; __m512i X=_mm512_set1_epi16(x); d=0;\n\t\t\t\tfor (__m512i *I=(__m512i*)a,*end=(__m512i*)(a+(i&~U));I!=end;++I){\n\t\t\t\t\t__m512i Y=_mm512_xor_si512(X,*I);\n\t\t\t\t\td+=__builtin_popcount(_mm512_cmpge_epi16_mask(Y,L)&_mm512_cmple_epi16_mask(Y,R));\n\t\t\t\t}\n\t\t\t\tfor (int j=i&~U;j<i;++j){int y=x^a[j]; d+=y>=l&&y<=r;}\n\t\t\t}\n\t\t\tans+=d;\n\t\t}\n\t\treturn ans;\n\t}\n};\n```\n",
      "createdAt": "2021-03-21T19:04:49.319019+00:00",
      "hitCount": 2172,
      "identifier": "P6bpnR",
      "isEditorsPick": false,
      "isMostPopular": false,
      "isMyFavorite": false,
      "next": {
        "__typename": "BriefSolutionNode",
        "slug": "dai-zhu-shi-de-cppzi-dian-shu-by-liu-xin-thli",
        "title": "å¸¦æ³¨é‡Šçš„cppå­—å…¸æ ‘"
      },
      "position": 1,
      "prev": null,
      "question": {
        "__typename": "QuestionNode",
        "questionTitleSlug": "count-pairs-with-xor-in-a-range"
      },
      "reactionType": null,
      "reactionsV2": [
        {
          "__typename": "ReactionCountNode",
          "count": 65,
          "reactionType": "UPVOTE"
        },
        {
          "__typename": "ReactionCountNode",
          "count": 3,
          "reactionType": "AWESOME"
        }
      ],
      "rewardEnabled": true,
      "slug": "bao-li-aczen-yao-neng-shao-de-liao-cni-b-j2co",
      "status": "PUBLISHED",
      "summary": "è§£é¢˜æ€è·¯\nä»€ä¹ˆï¼ŒJSæš´åŠ›è¿‡äº†ï¼Ÿä»€ä¹ˆï¼ŒJavaæš´åŠ›ä¹Ÿè¿‡äº†ï¼Ÿä»€ä¹ˆï¼Œè¿Pythonæš´åŠ›éƒ½è¿‡äº†ï¼Ÿç„¶è€Œæˆ‘ä»¬ä¼Ÿå¤§çš„C++åœ¨å“ªé‡Œï¼Ÿæˆ‘è¦æŠ•è¯‰ï¼Œè¿™æ˜¯è¯­è¨€æ­§è§†ï¼\né¦–å…ˆäº¤ä¸€ä¸ªæœ€æœ´ç´ çš„O(n^2)æš´åŠ›çœ‹çœ‹ï¼š\næœä¸å…¶ç„¶ï¼Œåœ¨ç¬¬48/61ä¸ªç‚¹å°±è¶…æ—¶äº†ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„è¿è¡Œé€Ÿåº¦ï¼šè€ƒè™‘å¦‚ä¸‹æé™æ•°æ®ï¼Œnums=1,...,20000ï¼Œlow=1, hig",
      "sunk": false,
      "tags": [
        {
          "__typename": "CommonTagNode",
          "name": "C++",
          "nameTranslated": "",
          "slug": "cpp",
          "tagType": "LANGUAGE"
        },
        {
          "__typename": "CommonTagNode",
          "name": "ç¨‹åºä¸ºä»€ä¹ˆä¼šè¶…æ—¶",
          "nameTranslated": "",
          "slug": "cheng-xu-wei-shi-yao-hui-chao-shi",
          "tagType": "ADDITIONAL_TOPIC"
        },
        {
          "__typename": "CommonTagNode",
          "name": "æš´åŠ›æ³•",
          "nameTranslated": "",
          "slug": "bao-li-fa",
          "tagType": "ADDITIONAL_TOPIC"
        }
      ],
      "thumbnail": "https://pic.leetcode-cn.com/1616355024-gjVEQY-3.png",
      "title": "æš´åŠ›ACæ€ä¹ˆèƒ½å°‘å¾—äº†C++å‘¢ï¼Ÿ",
      "topic": {
        "__typename": "TopicNode",
        "commentCount": 39,
        "id": 672266,
        "viewCount": 1685
      },
      "uuid": "P6bpnR",
      "videosInfo": []
    }
  }
}
