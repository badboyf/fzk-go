{
  "data": {
    "solutionArticle": {
      "__typename": "SolutionArticleNode",
      "author": {
        "__typename": "UserNode",
        "profile": {
          "__typename": "UserProfileNode",
          "realName": "zerotrac ğŸŒ¸",
          "userAvatar": "https://assets.leetcode-cn.com/aliyun-lc-upload/users/zerotrac2/avatar_1628749564.png",
          "userSlug": "zerotrac2"
        },
        "username": "zerotrac2"
      },
      "byLeetcode": false,
      "canEdit": false,
      "canEditReward": false,
      "canSee": true,
      "chargeType": "FREE",
      "content": "#### æ–¹æ³•ä¸€ï¼š$\\text{manacher}$ ç®—æ³• + æ‰«æçº¿\n\n**å‰è¨€**\n\næœ¬é¢˜**ä¸¥é‡è¶…çº²**ï¼Œç¬”è¯•ä¸å¤ªå¯èƒ½è€ƒï¼Œé¢è¯•ä¸€å®šä¸ä¼šè€ƒï¼ˆå¦‚æœåœ¨ç®€å†é‡Œæ²¡å†™æ˜¯ icpc é€‰æ‰‹çš„å‰æä¸‹è€ƒäº†ï¼Œè¯·å‘é‚®ä»¶ç»™ hr ä¸¾æŠ¥æ²¡æœ‰ b æ•°çš„é¢è¯•å®˜ï¼‰ã€‚é¢˜è§£ä»…ä¾›æ„Ÿå…´è¶£çš„è¯»è€…å­¦ä¹ ä½¿ç”¨ã€‚\n\nå…¶å®åšè¿™é“é¢˜ä¹‹å‰æˆ‘ä¹Ÿä¸ä¼š $\\text{manacher}$ ç®—æ³•ï¼Œæ˜¯å»ç°å­¦çš„ï¼ˆæ‰‹åŠ¨æ‚è„¸\n\n**ç¬¬ä¸€æ­¥**\n\nç¬¬ä¸€æ­¥å½“ç„¶æ˜¯è¦æŠŠä»¥æ¯ä¸ªä½ç½®ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡ä¸²é•¿åº¦æ±‚å‡ºæ¥ã€‚\n\næ¯”è¾ƒå¿«çš„ $O(n)$ åšæ³•æ˜¯ä½¿ç”¨ $\\text{manacher}$ ç®—æ³•ï¼Œæ¯”è¾ƒæ…¢ $O(n \\log n)$ è€Œä¸”å¸¸æ•°è¾ƒå¤§å†è€Œä¸”ä¸æ˜¯ $100\\%$ æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²å“ˆå¸Œã€‚å­—ç¬¦ä¸²å“ˆå¸Œæˆ‘åœ¨è¿™é‡Œä¸æ‰“ç®—è¯¦ç»†è¯´äº†ï¼Œå¤§æ¦‚å°±æ˜¯ã€Œæšä¸¾ä¸­é—´ä½ç½® $O(n)$ + äºŒåˆ†æŸ¥æ‰¾å›æ–‡ä¸²é•¿åº¦ $O(\\log n)$ + å­—ç¬¦ä¸²å“ˆå¸Œåˆ¤æ–­å·¦å³åŠè¾¹æ˜¯å¦ç›¸åŒ $O(1)$ã€ã€‚$\\text{manacher}$ ç®—æ³•çš„è¯å®˜æ–¹é¢˜è§£é‡Œé¢ä¹Ÿå‡ºç°è¿‡ï¼š\n\n- [ã€Œ5. æœ€é•¿å›æ–‡å­ä¸²ã€çš„å®˜æ–¹é¢˜è§£](https://leetcode-cn.com/problems/longest-palindromic-substring/solution/zui-chang-hui-wen-zi-chuan-by-leetcode-solution/)çš„æ–¹æ³•ä¸‰\n\né™¤æ­¤ä¹‹å¤–æˆ‘æ¯”è¾ƒæ¨è [oi-wiki](https://oi-wiki.org/string/manacher/) ä¸Šè®² $\\text{manacher}$ ç®—æ³•çš„æ–‡ç« ï¼Œéå¸¸è¯¦ç»†ï¼Œæˆ‘ä¸€éå°±çœ‹æ‡‚äº†ã€‚\n\n---\n\nç„¶åç°åœ¨å‡è®¾è¯»è€…çŸ¥é“ $\\text{manacher}$ ç®—æ³•æ€ä¹ˆå†™äº†ã€‚ç”±äºæœ¬é¢˜åªéœ€è¦æ‰¾å¥‡æ•°é•¿åº¦çš„å›æ–‡ä¸²ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ $\\text{manacher}$ ç®—æ³•ä¹‹å‰ï¼Œå°±ä¸éœ€è¦åœ¨å­—ç¬¦ä¹‹é—´æ’ä¸€ä¸ªæ— æ•ˆå­—ç¬¦äº†ã€‚\n\n**ç¬¬äºŒæ­¥**\n\nç°åœ¨å‡è®¾è¯»è€…å·²ç»æ±‚å‡ºäº†å­—ç¬¦ä¸² $s$ çš„æ¯ä¸ªä½ç½®ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡ä¸²é•¿åº¦ $\\textit{span}[i]$ï¼Œè¿™é‡Œ $\\textit{span}[i]$ è¡¨ç¤ºæœ‰ä¸€ä¸ªé•¿åº¦ä¸º $2 \\cdot \\textit{span}[i] - 1$ çš„å›æ–‡ä¸²ï¼Œé‚£ä¹ˆæ€ä¹ˆæŒ‘ä¸¤ä¸ªæœ€é•¿ä¸”ä¸é‡å çš„å‘¢ï¼Ÿ\n\nå¯ä»¥æƒ³åˆ°ä½¿ç”¨å‰ç¼€å’Œåç¼€å’Œçš„æ–¹æ³•ã€‚å‡è®¾ $\\textit{pre}[i]$ è¡¨ç¤º $s[0..i]$ ä¸­æœ€é•¿å›æ–‡ä¸²çš„é•¿åº¦ï¼Œ$\\textit{suf}[i]$ è¡¨ç¤º $s[i..n-1]$ ä¸­æœ€é•¿å›æ–‡ä¸²çš„é•¿åº¦ï¼Œè¿™æ ·æˆ‘ä»¬æšä¸¾ $i$ ä½œä¸ºä¸¤ä¸ªå›æ–‡ä¸²çš„åˆ†ç•Œä½ç½®ï¼Œ$\\textit{pre}[i] \\cdot \\textit{suf}[i+1]$ ä¸­çš„æœ€å¤§å€¼å³ä¸ºç­”æ¡ˆã€‚\n\nç°åœ¨çš„é—®é¢˜å°±æ˜¯æ±‚ $\\textit{pre}[i]$ å’Œ $\\textit{suf}[i]$ äº†ã€‚ç”±äºè¿™ä¸¤ä¸ªç©æ„æ˜¯å¾ˆç±»ä¼¼çš„ï¼Œå› æ­¤æˆ‘ä»¬å°±è®²è®² $\\textit{pre}[i]$ æ€ä¹ˆæ±‚ã€‚è¦æ˜¯çœ‹äº† $\\textit{pre}[i]$ è¿˜ä¸ä¼šæ±‚ $\\textit{suf}[i]$ çš„è¯ï¼Œå¤§ä¸äº†æŠŠå­—ç¬¦ä¸²ç¿»è½¬ä¸€ä¸‹å†è°ƒç”¨æ±‚ $\\textit{pre}[i]$ çš„ä»£ç ã€‚\n\n**ç¬¬ä¸‰æ­¥**\n\næœ‰äº›è¯»è€…å¯èƒ½ä¼šæƒ³å‡ºä¸€ä¸ªè¿™æ ·çš„æ–¹æ³•ï¼š\n\n- é¦–å…ˆæˆ‘ä»¬æšä¸¾ $i$ï¼Œç”±äºä»¥ $s[i]$ ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡ä¸²æ˜¯ $s\\big[i-\\textit{span}[i]+1, i+\\textit{span}[i]-1\\big]$ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°† $\\textit{pre}[i+\\textit{span}-1]$ æ›´æ–°ä¸ºå…¶ä¸ $2 \\cdot \\textit{span}[i] - 1$ çš„è¾ƒå¤§å€¼ï¼›\n\n- ç„¶åæˆ‘ä»¬å†æšä¸¾ $i$ï¼Œå°† $\\textit{pre}[i]$ æ›´æ–°ä¸ºå…¶ä¸ $\\textit{pre}[i-1]$ çš„è¾ƒå¤§å€¼ã€‚\n\nç›´è§‚ä¸Šæ¥è¯´ï¼Œè¿™ç§æ–¹æ³•å°±æ˜¯å°†æœ€é•¿å›æ–‡ä¸²çš„é•¿åº¦æŒ‚è½½åœ¨å³è¾¹ç•Œä¸Šï¼Œç„¶åæ±‚ä¸€ä¸‹å‰ç¼€å’Œå¾—åˆ° $\\textit{pre}[i]$ï¼Œå¯æƒœè¿™ç§æ–¹æ³•åªå¯¹äº†ä¸€åŠã€‚æœ€ç®€å•çš„åä¾‹å°±æ˜¯ï¼Œå¦‚æœ $s$ æ•´ä½“å°±æ˜¯ä¸€ä¸ªç±»ä¼¼äº $\\texttt{zyxw...cbabc...wxyz}$ çš„å›æ–‡ä¸²ï¼Œé‚£ä¹ˆè¿™æ ·éå†å®Œåªæœ‰ $\\textit{pre}[n-1]$ æœ‰å€¼ï¼Œå…¶ä½™ $\\textit{pre}[..]$ å‡ä¸º $1$ï¼Œè¿™æ ·æ˜¾ç„¶æ˜¯ä¸æ­£ç¡®çš„ã€‚\n\né‚£ä¹ˆåº”è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦å†åç€éå†ä¸€é $i$ï¼Œå°† $\\textit{pre}[i]$ æ›´æ–°ä¸ºå…¶ä¸ $\\textit{pre}[i+1] - 2$ çš„è¾ƒå¤§å€¼å³å¯ã€‚å…¶å¦™å¤„å°±åœ¨äºï¼š\n\n> å¦‚æœä»¥ä½ç½® $i+1$ ä¸ºå³è¾¹ç•Œï¼Œæœ‰ä¸€ä¸ªé•¿åº¦ä¸º $\\textit{pre}[i+1]$ çš„å›æ–‡ä¸²ï¼Œé‚£ä¹ˆä»¥ä½ç½® $i$ ä¸ºå³è¾¹ç•Œï¼Œå°±æœ‰ä¸€ä¸ªé•¿åº¦ä¸º $\\textit{pre}[i+1]-2$ çš„å›æ–‡ä¸²ï¼Œä¹Ÿå°±æ˜¯å°†å‰è€…çš„é¦–å°¾ä¸¤ä¸ªå­—ç¬¦å»æ‰ã€‚\n\nè¿™ç§æ–¹æ³•çš„æœ¬è´¨æ¨¡å‹ä¸ºï¼š\n\n- æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„ $\\textit{pre}$ï¼Œåˆå§‹æ—¶æ¯ä¸ªå…ƒç´ å‡ä¸º $0$ï¼›\n\n- æˆ‘ä»¬éœ€è¦è¿›è¡Œ $n$ æ¬¡æ›´æ–°æ“ä½œï¼Œæ¯ä¸€æ¬¡æ›´æ–°ç»™å®šä¸€ä¸ªå³è¾¹ç•Œ $r$ ä»¥åŠä»·å€¼ $v$ï¼Œå°†æ‰€æœ‰ä¸‹æ ‡å¤§äºç­‰äº $r$ çš„å…ƒç´ æ›´æ–°ä¸ºå…¶ä¸ $v$ çš„è¾ƒå¤§å€¼ï¼Œå°†æ‰€æœ‰ä¸‹æ ‡å°äº $r$ çš„å…ƒç´ ï¼ˆå‡è®¾ä¸‹æ ‡ä¸º $i$ï¼‰æ›´æ–°ä¸ºå…¶ä¸ $v - 2(r-i)$ çš„è¾ƒå¤§å€¼ï¼›\n\n- æœ€ç»ˆè¿”å›æ›´æ–°å®Œæˆåçš„ç»“æœã€‚\n\n**ç¬¬å››æ­¥**\n\nå†™ä»£ç ï¼\n\n**ä»£ç **\n\n```C++ [sol1-C++]\nclass Solution {\npublic:\n    long long maxProduct(string s) {\n        int n = s.size();\n        vector<int> span(n);\n\n        // manacher\n        for (int i = 0, l = 0, r = -1; i < n; ++i) {\n            span[i] = (i <= r ? min(span[l + r - i], r - i + 1) : 1);\n            while (i - span[i] >= 0 && i + span[i] < n && s[i - span[i]] == s[i + span[i]]) {\n                ++span[i];\n            }\n            if (i + span[i] - 1 > r) {\n                l = i - span[i] + 1;\n                r = i + span[i] - 1;\n            }\n        }\n\n        vector<int> pre(n), suf(n);\n        for (int i = 0; i < n; ++i) {\n            pre[i + span[i] - 1] = max(pre[i + span[i] - 1], span[i] * 2 - 1);\n            suf[i - span[i] + 1] = max(suf[i - span[i] + 1], span[i] * 2 - 1);\n        }\n\n        for (int i = 1; i < n; ++i) {\n            pre[i] = max(pre[i], pre[i - 1]);\n        }\n        for (int i = n - 2; i >= 0; --i) {\n            pre[i] = max(pre[i], pre[i + 1] - 2);\n        }\n        for (int i = n - 2; i >= 0; --i) {\n            suf[i] = max(suf[i], suf[i + 1]);\n        }\n        for (int i = 1; i < n; ++i) {\n            suf[i] = max(suf[i], suf[i - 1] - 2);\n        }\n\n        long long ans = 0;\n        for (int i = 0; i < n - 1; ++i) {\n            ans = max(ans, (long long)pre[i] * suf[i + 1]);\n        }\n        return ans;\n    }\n};\n```\n\n```Python [sol1-Python3]\nclass Solution:\n    def maxProduct(self, s: str) -> int:\n        n = len(s)\n        span = [0] * n\n        l, r = 0, -1\n\n        for i in range(n):\n            span[i] = (min(span[l + r - i], r - i + 1) if i <= r else 1)\n            while i - span[i] >= 0 and i + span[i] < n and s[i - span[i]] == s[i + span[i]]:\n                span[i] += 1\n            if i + span[i] - 1 > r:\n                l = i - span[i] + 1\n                r = i + span[i] - 1\n\n        pre, suf = [0] * n, [0] * n\n        for i in range(n):\n            pre[i + span[i] - 1] = max(pre[i + span[i] - 1], span[i] * 2 - 1)\n            suf[i - span[i] + 1] = max(suf[i - span[i] + 1], span[i] * 2 - 1)\n        \n        for i in range(1, n):\n            pre[i] = max(pre[i], pre[i - 1])\n        for i in range(n - 2, -1, -1):\n            pre[i] = max(pre[i], pre[i + 1] - 2)\n        for i in range(n - 2, -1, -1):\n            suf[i] = max(suf[i], suf[i + 1])\n        for i in range(1, n):\n            suf[i] = max(suf[i], suf[i - 1] - 2)\n\n        ans = max(pre[i] * suf[i + 1] for i in range(n - 1))\n        return ans\n```\n\n**ç¦»è°±**\n\n[è¿™é‡Œ](https://www.luogu.com.cn/problem/P4555) æœ‰ä¸€é“éå¸¸ç±»ä¼¼çš„é¢˜ç›®ã€‚\n\nè™½ç„¶ç°åœ¨ $\\text{manacher}$ ç®—æ³•åœ¨ç«èµ›åœˆé‡Œå·²ç»æŒºæ™®åŠçš„äº†ï¼Œä½†åœ¨ 2012 å¹´ï¼Œè¿™æ˜¯ä¸ªå›½å®¶é›†è®­é˜Ÿéš¾åº¦çš„è€ƒç‚¹ã€‚\n\næ‰€ä»¥è¯´å¦‚æœç¨‹åºå‘˜æ‰¾å·¥ä½œï¼Œç¬”è¯•é¢è¯•è€ƒ $\\text{manacher}$ ç®—æ³•çš„è¯ï¼Œæ˜¯çœŸçš„ç¦»è°±ã€‚å¦‚æœå­¦æœ‰ä½™åŠ›æˆ–è€…å¯¹ç®—æ³•ç«èµ›æ„Ÿå…´è¶£çš„è¯ï¼Œå€’å¯ä»¥å­¦ä¸€å­¦ï¼Œå°¤å…¶æ˜¯ä»”ç»†é¢†æ‚Ÿä¸€ä¸‹ $\\text{manacher}$ ç®—æ³•æ—¶é—´å¤æ‚åº¦è¯æ˜çš„éƒ¨åˆ†ã€‚\n\n**å¤æ‚åº¦åˆ†æ**\n\n- æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ã€‚\n\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ã€‚\n",
      "createdAt": "2021-08-07T16:06:11.142536+00:00",
      "hitCount": 2566,
      "identifier": "bL55gE",
      "isEditorsPick": false,
      "isMostPopular": false,
      "isMyFavorite": false,
      "next": {
        "__typename": "BriefSolutionNode",
        "slug": "ma-la-che-suan-fa-xiang-xi-tu-jie-by-new-m2zj",
        "title": "å›¾è§£æ€è·¯-é©¬æ‹‰è½¦ç®—æ³•"
      },
      "position": 1,
      "prev": null,
      "question": {
        "__typename": "QuestionNode",
        "questionTitleSlug": "maximum-product-of-the-length-of-two-palindromic-substrings"
      },
      "reactionType": null,
      "reactionsV2": [
        {
          "__typename": "ReactionCountNode",
          "count": 25,
          "reactionType": "UPVOTE"
        },
        {
          "__typename": "ReactionCountNode",
          "count": 3,
          "reactionType": "AWESOME"
        },
        {
          "__typename": "ReactionCountNode",
          "count": 1,
          "reactionType": "CONFUSED"
        }
      ],
      "rewardEnabled": false,
      "slug": "liang-ge-hui-wen-zi-zi-fu-chuan-chang-du-soyb",
      "status": "PUBLISHED",
      "summary": "æ–¹æ³•ä¸€ï¼š\\text{manacher} ç®—æ³• + æ‰«æçº¿\nå‰è¨€\næœ¬é¢˜ä¸¥é‡è¶…çº²ï¼Œç¬”è¯•ä¸å¤ªå¯èƒ½è€ƒï¼Œé¢è¯•ä¸€å®šä¸ä¼šè€ƒï¼ˆå¦‚æœåœ¨ç®€å†é‡Œæ²¡å†™æ˜¯ icpc é€‰æ‰‹çš„å‰æä¸‹è€ƒäº†ï¼Œè¯·å‘é‚®ä»¶ç»™ hr ä¸¾æŠ¥æ²¡æœ‰ b æ•°çš„é¢è¯•å®˜ï¼‰ã€‚é¢˜è§£ä»…ä¾›æ„Ÿå…´è¶£çš„è¯»è€…å­¦ä¹ ä½¿ç”¨ã€‚\nå…¶å®åšè¿™é“é¢˜ä¹‹å‰æˆ‘ä¹Ÿä¸ä¼š \\text{manacher} ç®—æ³•ï¼Œæ˜¯å»ç°å­¦çš„ï¼ˆæ‰‹åŠ¨æ‚",
      "sunk": false,
      "tags": [
        {
          "__typename": "CommonTagNode",
          "name": "String",
          "nameTranslated": "å­—ç¬¦ä¸²",
          "slug": "string",
          "tagType": "TOPIC"
        },
        {
          "__typename": "CommonTagNode",
          "name": "Dynamic Programming",
          "nameTranslated": "åŠ¨æ€è§„åˆ’",
          "slug": "dynamic-programming",
          "tagType": "TOPIC"
        },
        {
          "__typename": "CommonTagNode",
          "name": "Line Sweep",
          "nameTranslated": "æ‰«æçº¿",
          "slug": "line-sweep",
          "tagType": "TOPIC"
        },
        {
          "__typename": "CommonTagNode",
          "name": "C++",
          "nameTranslated": "",
          "slug": "cpp",
          "tagType": "LANGUAGE"
        },
        {
          "__typename": "CommonTagNode",
          "name": "Python",
          "nameTranslated": "",
          "slug": "python",
          "tagType": "LANGUAGE"
        }
      ],
      "thumbnail": "",
      "title": "ä¸¤ä¸ªå›æ–‡å­å­—ç¬¦ä¸²é•¿åº¦çš„æœ€å¤§ä¹˜ç§¯",
      "topic": {
        "__typename": "TopicNode",
        "commentCount": 24,
        "id": 921974,
        "viewCount": 1870
      },
      "uuid": "bL55gE",
      "videosInfo": []
    }
  }
}
